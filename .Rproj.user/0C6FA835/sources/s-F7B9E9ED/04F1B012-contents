---
title: "NYCOpenData"
output: html_document
---

```{r setup, include=FALSE}

library(tidyverse)
library(utils)
library(rvest)
library(stringi)
library(jsonlite)
library(geoclient)

knitr::opts_chunk$set(echo = TRUE)

geoclient_api_key(key = "1f02b4033c75431bbba245d5e8015a93")
```


```{r}
openstreets <- read.csv("https://data.cityofnewyork.us/api/views/uiay-nctu/rows.csv?accessType=DOWNLOAD") %>% 
  mutate(id = row_number(),
         Borough = tolower(Borough))
```

```{r}
count(openstreets, Borough)

```

```{r}

intersections_from <- openstreets %>% 
  geo_intersection_data(cross_street_1 = On.Street,
                        cross_street_2 = From.Street,
                        borough = Borough) %>% 
  select(longitude, latitude) %>% 
  rename(longitude_from = longitude,
         latitude_from = latitude) %>% 
  mutate(id = row_number())

intersections_to <- openstreets %>% 
  geo_intersection_data(cross_street_1 = On.Street,
                        cross_street_2 = To.Street,
                        borough = Borough) %>% 
  select(longitude, latitude) %>% 
  rename(longitude_to = longitude,
         latitude_to = latitude) %>% 
  mutate(id = row_number())

```
```{r}

merged <- left_join(openstreets, intersections_from, by = c("id")) %>% 
  left_join(openstreets, intersections_to, by = c("id"))

```

